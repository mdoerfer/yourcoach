<ion-header>

  <ion-navbar color="primary">
    <ion-title>{{user?.name}}</ion-title>
    <ion-buttons end>
      <button ion-button icon-only (click)="presentPopover($event)">
        <ion-icon name="more"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

  <ion-toolbar color="primary">
    <ion-segment color="navtext" [(ngModel)]="activeTab">
      <ion-segment-button value="open">
        Offen
      </ion-segment-button>
      <ion-segment-button value="grade">
        Zu bewerten
      </ion-segment-button>
      <ion-segment-button value="done">
        Abgeschlossen
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content padding>
  <div [ngSwitch]="activeTab">
    <div *ngSwitchCase="'open'">
      <div *ngIf="openAssignments.length == 0"><img class="no-task" src="assets/images/notask.png">
        </div>

      <div *ngIf="openAssignments.length > 0">
        <ion-card *ngFor="let assignment of openAssignments; let i = index" (press)="openActionSheet(assignment._id)">
          <div>
            <ion-item (tap)="toggle(assignment)">
              <ion-grid>
                <ion-row>
                  <ion-col>
                    <h2>{{assignment.title}}</h2>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col>
                    <ion-note item-left>{{assignment.created_at | date}}</ion-note>
                  </ion-col>
                  <ion-col text-right>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Schwer'" color="badgehard" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Mittel'" color="badgemedium" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Einfach'" color="badgeeasy" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-item>

            <ion-card-content *ngIf="assignment.open" text-wrap>
              <p>{{assignment.description}}</p>
            </ion-card-content>

            <ion-item *ngIf="assignment.open" text-wrap>
              <h2>Rückmeldung</h2>
              <p>{{assignment.responseType}}</p>
              <p *ngIf="assignment.responseInstructions">{{assignment.responseInstructions}}</p>
            </ion-item>

            <ion-row *ngIf="assignment.open">
              <ion-col text-right>
                <button ion-button icon-left clear small (click)="openChat(assignment)">
                  <ion-icon name="text"></ion-icon>
                  <div>Chat</div>
                </button>
              </ion-col>
            </ion-row>
          </div>
        </ion-card>
      </div>
    </div>

    <div *ngSwitchCase="'grade'">
      <div *ngIf="gradeAssignments.length == 0"><img class="no-task" src="assets/images/notask.png"></div>

      <div *ngIf="gradeAssignments.length > 0">
        <ion-card *ngFor="let assignment of gradeAssignments; let i = index;" (press)="openActionSheet(assignment._id)">
          <div>
            <ion-item (tap)="toggle(assignment)">
              <ion-grid>
                <ion-row>
                  <ion-col>
                    <h2>{{assignment.title}}</h2>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col>
                    <ion-note item-left>{{assignment.created_at | date}}</ion-note>
                  </ion-col>
                  <ion-col text-right>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Schwer'" color="badgehard" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Mittel'" color="badgemedium" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Einfach'" color="badgeeasy" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-item>

            <ion-card-content *ngIf="assignment.open" text-wrap>
              <p>{{assignment.description}}</p>
            </ion-card-content>

            <ion-item *ngIf="assignment.open" text-wrap>
              <h2>Rückmeldung</h2>
              <p>{{assignment.responseType}}</p>
              <p *ngIf="assignment.responseInstructions">{{assignment.responseInstructions}}</p>
              <p>{{assignment.response}}</p>
            </ion-item>

            <ion-row>
              <ion-col text-left>
                <rating [(ngModel)]="assignment.rating" readOnly="false" max="3"
                        (click)="rateAssignmentAndMarkAsDone(assignment)"></rating>
              </ion-col>
              <ion-col text-right *ngIf="assignment.open">
                <button ion-button icon-left clear small (click)="openChat(assignment)">
                  <ion-icon name="text"></ion-icon>
                  <div>Chat</div>
                </button>
              </ion-col>
            </ion-row>
          </div>
        </ion-card>
      </div>
    </div>

    <div *ngSwitchCase="'done'">
      <div *ngIf="doneAssignments.length == 0"><img class="no-task" src="assets/images/notask.png"></div>

      <div *ngIf="doneAssignments.length > 0">
        <ion-card *ngFor="let assignment of doneAssignments; let i = index;" (press)="openActionSheet(assignment._id)">
          <div>
            <ion-item (tap)="toggle(assignment)">
              <ion-grid>
                <ion-row>
                  <ion-col>
                    <h2>{{assignment.title}}</h2>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col>
                    <ion-note item-left>{{assignment.created_at | date}}</ion-note>
                  </ion-col>
                  <ion-col text-right>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Schwer'" color="badgehard" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Mittel'" color="badgemedium" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                    <ion-badge item-right *ngIf="assignment.difficulty=='Einfach'" color="badgeeasy" class="difficulty">{{assignment.difficulty}}
                    </ion-badge>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-item>

            <ion-card-content *ngIf="assignment.open" text-wrap>
              <p>{{assignment.description}}</p>
            </ion-card-content>

            <ion-item *ngIf="assignment.open" text-wrap>
              <h2>Rückmeldung</h2>
              <p>{{assignment.responseType}}</p>
              <p *ngIf="assignment.responseInstructions">{{assignment.responseInstructions}}</p>
              <p>{{assignment.response}}</p>
            </ion-item>

            <ion-row>
              <ion-col text-left>
                <rating [(ngModel)]="assignment.rating" readOnly="true" max="3"></rating>
              </ion-col>
              <ion-col text-right *ngIf="assignment.open">
                <button ion-button icon-left clear small (click)="openChat(assignment)">
                  <ion-icon name="text"></ion-icon>
                  <div>Chat</div>
                </button>
              </ion-col>
            </ion-row>
          </div>
        </ion-card>
      </div>
    </div>
  </div>

  <ion-fab right bottom>
    <button ion-fab color="secondary" (click)="goToCreateTask()">
      <ion-icon name="add"></ion-icon>
    </button>
  </ion-fab>
</ion-content>
